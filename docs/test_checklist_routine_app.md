# routine_app テスト仕様書

## 1. 対象
- プロジェクト名: `routine_app`
- URL: `https://mercury/routine_app/`
- 対象機能: ルーチンタスクの登録・一覧・更新・完了

## 2. 前提条件
| ID | 前提条件 | 判定 | 備考 |
|---|---|---|---|
| PRE-001 | IISアプリ `/routine_app` の物理パスが `D:\asp\routine_app` |  |  |
| PRE-002 | `D:\asp\routine_app\.venv` が存在し、依存モジュール導入済み |  |  |
| PRE-003 | `D:\asp\routine_app\.env` が設定済み |  |  |
| PRE-004 | Entra Redirect URI に `https://mercury/routine_app/auth/redirect` を登録済み |  |  |
| PRE-005 | DB接続が可能 |  |  |

## 3. テスト方針（3.3 登録・一覧・更新・完了）
### 3.1 API観点
1. `POST /routine_app/api.py/routines` で登録
2. `GET /routine_app/api.py/routines?page=1&page_size=20` で一覧取得
3. `task_no` / `record_no` を取得
4. `PATCH /routine_app/api.py/parent/{task_no}` で親更新
5. `PATCH /routine_app/api.py/child/{record_no}` で子更新
6. `POST /routine_app/api.py/child/{record_no}/complete` で子完了
7. `POST /routine_app/api.py/parent/{task_no}/complete` で親完了

### 3.2 直交表ベース（開始月=2026-02）
| Case | frequency | task_kind | assignee数 | week | 期間 | status | 期待HTTP |
|---|---|---|---|---|---|---|---|
| O-01 | 月次 | 個人 | 1 | 1 | 1か月 | 未着手 | 201 |
| O-02 | 月次 | グループ | 2 | 4 | 3か月 | 着手 | 201 |
| O-03 | 四半期 | 個人 | 1 | 1 | 3か月 | 着手 | 201 |
| O-04 | 四半期 | グループ | 2 | 4 | 3か月 | 未着手 | 201 |
| O-05 | 月次 | 個人 | 1 | 4 | 3か月 | 未着手 | 201 |
| O-06 | 月次 | グループ | 2 | 1 | 1か月 | 着手 | 201 |
| O-07 | スポット | 個人 | 1 | - | - | 未着手 | 201 |
| O-08 | スポット | グループ | 2 | - | - | 着手 | 201 |
| O-09 | 四半期 | 個人 | 1 | 4 | 3か月 | 未着手 | 201 |
| O-10 | 四半期 | グループ | 2 | 1 | 3か月 | 着手 | 201 |
| O-11 | 月次 | 個人 | 1 | 1 | 3か月 | 着手 | 201 |
| O-12 | 月次 | グループ | 2 | 4 | 1か月 | 未着手 | 201 |
| O-13 | 週次 | 個人 | 1 | 1 | 2026-02〜2027-01 | 未着手 | 201 |
| O-14 | 年次 | グループ | 2 | 4 | 2026-02〜2027-12 | 着手 | 201 |

### 3.3 実施結果記録欄
| Case | 登録(201) | 一覧取得(200) | 親更新(204) | 子更新(204) | 子完了(204) | 親完了(204) | DB確認 | 備考 |
|---|---|---|---|---|---|---|---|---|
| O-01 | OK | OK | OK | OK | OK | OK | OK | task_no=103（親は子完了連動で自動完了） |
| O-02 | OK | OK | OK | OK | OK | OK | OK | task_no=104 |
| O-03 | OK | OK | OK | OK | OK | OK | OK | task_no=105（親は子完了連動で自動完了） |
| O-04 | OK | OK | OK | OK | OK | OK | OK | task_no=106（親は子完了連動で自動完了） |
| O-05 | OK | OK | OK | OK | OK | OK | OK | task_no=107 |
| O-06 | OK | OK | OK | OK | OK | OK | OK | task_no=108（親は子完了連動で自動完了） |
| O-07 | OK | OK | OK | OK | OK | OK | OK | task_no=109（親は子完了連動で自動完了） |
| O-08 | OK | OK | OK | OK | OK | OK | OK | task_no=110（親は子完了連動で自動完了） |
| O-09 | OK | OK | OK | OK | OK | OK | OK | task_no=111（親は子完了連動で自動完了） |
| O-10 | OK | OK | OK | OK | OK | OK | OK | task_no=112（親は子完了連動で自動完了） |
| O-11 | OK | OK | OK | OK | OK | OK | OK | task_no=113 |
| O-12 | OK | OK | OK | OK | OK | OK | OK | task_no=114（親は子完了連動で自動完了） |
| O-13 | OK | OK | OK | OK | OK | OK | OK | task_no=115 |
| O-14 | OK | OK | OK | OK | OK | OK | OK | task_no=116 |

## 4. 入力値（ケース定義）
### 4.1 入力値詳細
| Case | frequency | start_month | end_month | due_date | week | task_kind | assignee | status | 期待レコード数 |
|---|---|---|---|---|---|---|---|---|---|
| O-01 | 月次 | 2026-02 | 2026-02 | - | 1 | 個人 | 森雅俊 | 未着手 | 1 |
| O-02 | 月次 | 2026-02 | 2026-04 | - | 4 | グループ | 越田一寿; 河野竜樹 | 着手 | 3 |
| O-03 | 四半期 | 2026-02 | 2026-04 | - | 1 | 個人 | 岩崎和彦 | 着手 | 1 |
| O-04 | 四半期 | 2026-02 | 2026-04 | - | 4 | グループ | 金巻貴洋; 高沢 冬樹 | 未着手 | 1 |
| O-05 | 月次 | 2026-02 | 2026-04 | - | 4 | 個人 | 山田晴佳 | 未着手 | 3 |
| O-06 | 月次 | 2026-02 | 2026-02 | - | 1 | グループ | 山野 輝; 大塚 由樹子 | 着手 | 1 |
| O-07 | スポット | - | - | 2026-02-20 | - | 個人 | 竹中学 | 未着手 | 1 |
| O-08 | スポット | - | - | 2026-02-27 | - | グループ | 藤田佳那子; 飯ヶ谷充 | 着手 | 1 |
| O-09 | 四半期 | 2026-02 | 2026-04 | - | 4 | 個人 | 越田一寿 | 未着手 | 1 |
| O-10 | 四半期 | 2026-02 | 2026-04 | - | 1 | グループ | 河野竜樹; 岩崎和彦 | 着手 | 1 |
| O-11 | 月次 | 2026-02 | 2026-04 | - | 1 | 個人 | 金巻貴洋 | 着手 | 3 |
| O-12 | 月次 | 2026-02 | 2026-02 | - | 4 | グループ | 高沢 冬樹; 山田晴佳 | 未着手 | 1 |
| O-13 | 週次 | 2026-02 | 2027-01 | - | 1 | 個人 | 山野 輝 | 未着手 | 12 |
| O-14 | 年次 | 2026-02 | 2027-12 | - | 4 | グループ | 森雅俊; 飯ヶ谷充 | 着手 | 2 |

## 5. ログ
- アプリログ: `D:\asp\routine_app\logs\wfastcgi.log`
- IISログ: `C:\inetpub\logs\LogFiles\W3SVC*`
- API結果JSON: `test-results/api-ortho-results.json`

## 6. 自動実行結果
- 実行日時: 2026-02-18 08:23〜08:23 JST（最新実行）
- 実行ケース数: 14（O-01〜O-14）
- assigneeカバレッジ: 11/11名
- 判定: 全ケース PASS（登録/一覧/親更新/子更新/子完了/親完了/DB確認）
- 備考: 親タスクは仕様どおり、子ルーチン完了時に一部ケースで自動完了


